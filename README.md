# 炸金花 (Boom Golden Flower)

在线多人炸金花游戏，支持真人与AI对战，实时WebSocket通信。

## 运行

```bash
npm install
npm run dev      # 前端 (http://localhost:3000)
npm run server   # 后端 (ws://localhost:3001)
```

## 游戏规则

### 牌型大小（从大到小）
| 牌型 | 说明 | 权重 |
|------|------|------|
| 豹子 | 三张相同点数 (AAA最大) | 8000+ |
| 同花顺 | 同花色连续 (AKQ最大, A23最小) | 7000+ |
| 同花 | 同花色不连续 | 6000+ |
| 顺子 | 不同花色连续 | 5000+ |
| 对子 | 两张相同点数 | 4000+ |
| 散牌 | 按最大牌比较 | 0-1400 |

### 焖牌规则
焖牌是诈金花的核心策略，不看牌下注可以获得优势：

| 我的状态 | 上家状态 | 我需要跟注 |
|----------|----------|------------|
| 焖牌(未看) | 已看牌 | 上家下注的一半 |
| 已看牌 | 焖牌(未看) | 上家下注的双倍 |
| 焖牌 | 焖牌 | 同额 |
| 已看牌 | 已看牌 | 同额 |

### 开牌规则
- 选择一个对手进行开牌比较
- 开牌费用 = 上家本轮下注金额
- 牌型相同时，挑战者（发起开牌方）判负
- 输家弃牌，赢家继续游戏

## 功能特性

### 游戏玩法
- 2-8人同桌对战
- 智能AI对手（分析对手行为模式、诈唬识别、动态策略调整）
- 焖牌/看牌机制
- 开牌比牌
- 断线重连（5分钟内可重连恢复座位）

### 用户系统
- 注册/登录
- 每日签到（连续签到奖励递增，最高7天350筹码）
- 筹码实时同步
- 战绩统计（胜场、总场次、胜率）
- 排行榜（筹码榜、胜场榜、胜率榜）

### 动画效果
- 发牌动画（逆时针依次发牌，每张间隔0.3秒）
- 筹码飞入底池动画
- 底池数字递增动画

### AI策略
- 牌力评估（豹子、同花顺、同花、顺子、对子、散牌）
- 对手行为分析（激进/保守、诈唬倾向、牌力推测）
- 焖牌策略（强牌慢玩、弱牌虚张声势）
- 开牌目标选择（评分系统选择最佳目标）
- 只剩AI时速战速决（50ms延迟，最强AI直接开牌）

## 技术栈

- 前端：Vue 3 + Vite
- 后端：Node.js + WebSocket (ws)
- 数据存储：JSON文件 (users_data.json)
- 通信协议：WebSocket 双向实时通信

## 项目结构

```
├── server.js              # 服务端入口
├── server/
│   ├── game/
│   │   ├── GameEngine.js  # 游戏引擎（核心逻辑、AI决策）
│   │   ├── GameState.js   # 游戏状态管理
│   │   └── Room.js        # 房间管理（玩家、重连）
│   └── models/
│       ├── Card.js        # 扑克牌
│       ├── Deck.js        # 牌组
│       ├── Hand.js        # 手牌（牌型判断）
│       └── Player.js      # 玩家
├── src/
│   ├── App.vue            # 主应用
│   ├── components/        # Vue组件
│   │   ├── GameTable.vue  # 牌桌
│   │   ├── GameControls.vue # 操作按钮
│   │   ├── PlayerComponent.vue # 玩家显示
│   │   └── ...
│   ├── game/              # 客户端游戏逻辑
│   └── utils/             # 工具类（网络、音效、用户管理）
└── users_data.json        # 用户数据存储
```

## 通信协议

### 客户端 → 服务端
- `create_room` - 创建房间
- `join_room` - 加入房间
- `reconnect` - 断线重连
- `start_game` - 开始游戏
- `player_action` - 玩家操作 (peek/call/raise/blind/fold/showdown)
- `add_ai` / `remove_ai` - 添加/移除AI
- `register` / `login` - 注册/登录
- `sign_in` - 每日签到

### 服务端 → 客户端
- `game_state` - 游戏状态同步
- `action_result` - 操作结果
- `player_joined` / `player_left` - 玩家进出
- `player_disconnected` / `player_reconnected` - 断线/重连通知
